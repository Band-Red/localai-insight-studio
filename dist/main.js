/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/main/engine_setup.ts"
/*!**********************************!*\
  !*** ./src/main/engine_setup.ts ***!
  \**********************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   EngineSetupManager: () => (/* binding */ EngineSetupManager)\n/* harmony export */ });\n/* harmony import */ var child_process__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! child_process */ \"child_process\");\n/* harmony import */ var child_process__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(child_process__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var electron__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! electron */ \"electron\");\n/* harmony import */ var electron__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(electron__WEBPACK_IMPORTED_MODULE_3__);\n\n\n\n\nclass EngineSetupManager {\n    getBinPath() {\n        const isPackaged = electron__WEBPACK_IMPORTED_MODULE_3__.app.isPackaged;\n        const rootDir = isPackaged ? process.resourcesPath : path__WEBPACK_IMPORTED_MODULE_1___default().join(__dirname, '..');\n        const binFolder = path__WEBPACK_IMPORTED_MODULE_1___default().join(rootDir, 'bin');\n        if (!fs__WEBPACK_IMPORTED_MODULE_2___default().existsSync(binFolder)) {\n            fs__WEBPACK_IMPORTED_MODULE_2___default().mkdirSync(binFolder, { recursive: true });\n        }\n        return binFolder;\n    }\n    async ensureEngineAvailable(onProgress) {\n        const binFolder = this.getBinPath();\n        const exePath = path__WEBPACK_IMPORTED_MODULE_1___default().join(binFolder, 'llama-server.exe');\n        if (fs__WEBPACK_IMPORTED_MODULE_2___default().existsSync(exePath)) {\n            onProgress('المحرك موجود وجاهز للعمل.');\n            return true;\n        }\n        onProgress('جاري تحميل المحرك السيادي (llama-server) لأول مرة، يرجى الانتظار...');\n        // استخدام PowerShell لتحميل وفك ضغط المحرك برمجياً بدون مكاتب إضافية\n        const zipUrl = \"https://github.com/ggerganov/llama.cpp/releases/download/b4300/llama-b4300-bin-win-avx2-x64.zip\";\n        const zipFile = path__WEBPACK_IMPORTED_MODULE_1___default().join(binFolder, 'llama-server.zip');\n        const psCommand = `\r\n            $ProgressPreference = 'SilentlyContinue';\r\n            Invoke-WebRequest -Uri \"${zipUrl}\" -OutFile \"${zipFile}\";\r\n            Expand-Archive -Path \"${zipFile}\" -DestinationPath \"${binFolder}\" -Force;\r\n            Remove-Item \"${zipFile}\";\r\n        `.replace(/\\n/g, ' ');\n        return new Promise((resolve) => {\n            (0,child_process__WEBPACK_IMPORTED_MODULE_0__.exec)(`powershell -NoProfile -Command \"${psCommand}\"`, (error) => {\n                if (error || !fs__WEBPACK_IMPORTED_MODULE_2___default().existsSync(exePath)) {\n                    onProgress('فشل في تحميل المحرك تلقائياً، يرجى التحقق من اتصال الإنترنت.');\n                    resolve(false);\n                }\n                else {\n                    onProgress('تم تثبيت المحرك بنجاح!');\n                    resolve(true);\n                }\n            });\n        });\n    }\n}\n\n\n//# sourceURL=webpack://local-ai-studio/./src/main/engine_setup.ts?\n}");

/***/ },

/***/ "./src/main/logger_manager.ts"
/*!************************************!*\
  !*** ./src/main/logger_manager.ts ***!
  \************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   LoggerManager: () => (/* binding */ LoggerManager)\n/* harmony export */ });\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var electron__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! electron */ \"electron\");\n/* harmony import */ var electron__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(electron__WEBPACK_IMPORTED_MODULE_2__);\n\n\n\nconst LOGS_DIR = path__WEBPACK_IMPORTED_MODULE_1___default().join(electron__WEBPACK_IMPORTED_MODULE_2__.app.getPath('userData'), 'logs');\nclass LoggerManager {\n    logFilePath;\n    constructor() {\n        if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(LOGS_DIR)) {\n            fs__WEBPACK_IMPORTED_MODULE_0___default().mkdirSync(LOGS_DIR, { recursive: true });\n        }\n        const today = new Date().toISOString().split('T')[0];\n        this.logFilePath = path__WEBPACK_IMPORTED_MODULE_1___default().join(LOGS_DIR, `metrics_${today}.csv`);\n        this.initHeader();\n    }\n    initHeader() {\n        if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(this.logFilePath)) {\n            const header = 'timestamp,event,cpuUsage,ramUsage,latency,status\\n';\n            fs__WEBPACK_IMPORTED_MODULE_0___default().writeFileSync(this.logFilePath, header, 'utf-8');\n        }\n    }\n    addLog(entry) {\n        try {\n            const timestamp = new Date().toISOString();\n            const row = `${timestamp},${entry.event},${entry.cpuUsage},${entry.ramUsage},${entry.latency},${entry.status}\\n`;\n            fs__WEBPACK_IMPORTED_MODULE_0___default().appendFileSync(this.logFilePath, row, 'utf-8');\n            return { success: true };\n        }\n        catch (error) {\n            console.error('Failed to write log:', error);\n            return { success: false, error };\n        }\n    }\n    getRecentLogs(limit = 50) {\n        try {\n            if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(this.logFilePath))\n                return [];\n            const data = fs__WEBPACK_IMPORTED_MODULE_0___default().readFileSync(this.logFilePath, 'utf-8');\n            const lines = data.trim().split('\\n').slice(1); // Skip header\n            const entries = lines.map(line => {\n                const [timestamp, event, cpuUsage, ramUsage, latency, status] = line.split(',');\n                return {\n                    timestamp,\n                    event,\n                    cpuUsage: parseFloat(cpuUsage),\n                    ramUsage: parseFloat(ramUsage),\n                    latency: parseFloat(latency),\n                    status: status\n                };\n            });\n            return entries.slice(-limit);\n        }\n        catch (error) {\n            console.error('Failed to read logs:', error);\n            return [];\n        }\n    }\n}\n\n\n//# sourceURL=webpack://local-ai-studio/./src/main/logger_manager.ts?\n}");

/***/ },

/***/ "./src/main/main.ts"
/*!**************************!*\
  !*** ./src/main/main.ts ***!
  \**************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var electron__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! electron */ \"electron\");\n/* harmony import */ var electron__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(electron__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var child_process__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! child_process */ \"child_process\");\n/* harmony import */ var child_process__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(child_process__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var os__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! os */ \"os\");\n/* harmony import */ var os__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(os__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var dotenv__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! dotenv */ \"dotenv\");\n/* harmony import */ var dotenv__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(dotenv__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var _model_manager__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./model_manager */ \"./src/main/model_manager.ts\");\n/* harmony import */ var _session_manager__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./session_manager */ \"./src/main/session_manager.ts\");\n/* harmony import */ var _obsidian_exporter__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./obsidian_exporter */ \"./src/main/obsidian_exporter.ts\");\n/* harmony import */ var _settings_manager__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./settings_manager */ \"./src/main/settings_manager.ts\");\n/* harmony import */ var _logger_manager__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./logger_manager */ \"./src/main/logger_manager.ts\");\n/* harmony import */ var _rag_manager__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./rag_manager */ \"./src/main/rag_manager.ts\");\n/* harmony import */ var _engine_setup__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./engine_setup */ \"./src/main/engine_setup.ts\");\n\n\n\n\n\n\n// Load .env file\ndotenv__WEBPACK_IMPORTED_MODULE_5__.config();\n\n\n\n\n\n\n\nclass MainApp {\n    mainWindow = null;\n    modelManager = new _model_manager__WEBPACK_IMPORTED_MODULE_6__.ModelManager();\n    sessionManager = new _session_manager__WEBPACK_IMPORTED_MODULE_7__.SessionManager();\n    exporter = new _obsidian_exporter__WEBPACK_IMPORTED_MODULE_8__.ObsidianExporter();\n    logger = new _logger_manager__WEBPACK_IMPORTED_MODULE_10__.LoggerManager();\n    ragManager = new _rag_manager__WEBPACK_IMPORTED_MODULE_11__.RagManager();\n    engineSetup = new _engine_setup__WEBPACK_IMPORTED_MODULE_12__.EngineSetupManager();\n    mcpConfigPath = path__WEBPACK_IMPORTED_MODULE_2___default().join(os__WEBPACK_IMPORTED_MODULE_4___default().homedir(), '.localai-insight-studio', 'mcp.json');\n    lastCpuInfo = null;\n    constructor() {\n        this.initApp();\n    }\n    initApp() {\n        // Ensure app waits for ready state properly\n        electron__WEBPACK_IMPORTED_MODULE_0__.app.whenReady().then(() => {\n            this.createWindow();\n            this.setupIpc();\n            electron__WEBPACK_IMPORTED_MODULE_0__.app.on('activate', () => {\n                if (electron__WEBPACK_IMPORTED_MODULE_0__.BrowserWindow.getAllWindows().length === 0) {\n                    this.createWindow();\n                }\n            });\n        });\n        electron__WEBPACK_IMPORTED_MODULE_0__.app.on('window-all-closed', () => {\n            if (process.platform !== 'darwin') {\n                electron__WEBPACK_IMPORTED_MODULE_0__.app.quit();\n            }\n        });\n    }\n    createWindow() {\n        this.mainWindow = new electron__WEBPACK_IMPORTED_MODULE_0__.BrowserWindow({\n            width: 1400, // Slightly wider for better initial experience\n            height: 900,\n            webPreferences: {\n                preload: path__WEBPACK_IMPORTED_MODULE_2___default().join(__dirname, 'preload.js'),\n                contextIsolation: true,\n                nodeIntegration: false,\n                sandbox: false // Recommended for better tool communication in dev\n            },\n            backgroundColor: '#050507',\n            frame: false,\n            show: false // Don't show until ready-to-show\n        });\n        this.mainWindow.loadFile(path__WEBPACK_IMPORTED_MODULE_2___default().join(__dirname, 'index.html'));\n        this.mainWindow.once('ready-to-show', () => {\n            if (this.mainWindow) {\n                this.mainWindow.show();\n            }\n        });\n        // تحقق من المحرك وتثبيته في الخلفية عند الإقلاع\n        this.engineSetup.ensureEngineAvailable((msg) => {\n            console.log(`[Engine Setup]: ${msg}`);\n            if (this.mainWindow && !this.mainWindow.isDestroyed()) {\n                this.mainWindow.webContents.send('engine:setup-status', msg);\n            }\n        });\n    }\n    setupIpc() {\n        // ── Legacy Ollama (backward compat) ─────────────────────────────\n        electron__WEBPACK_IMPORTED_MODULE_0__.ipcMain.handle('model:status', () => this.modelManager.getStatus());\n        electron__WEBPACK_IMPORTED_MODULE_0__.ipcMain.handle('chat:send', async (_e, message, model) => {\n            const startTime = Date.now();\n            try {\n                const context = this.ragManager.getContextString();\n                const fullPrompt = context ? `${context}\\nالمستخدم يقول: ${message}` : message;\n                const response = await this.modelManager.chat(fullPrompt, model);\n                const latency = Date.now() - startTime;\n                this.logger.addLog({ event: 'AI_Chat_Success', cpuUsage: 15, ramUsage: 45, latency, status: 'success' });\n                return { success: true, response };\n            }\n            catch (err) {\n                console.error('[Chat Error]:', err);\n                this.logger.addLog({ event: 'AI_Chat_Error', cpuUsage: 5, ramUsage: 10, latency: Date.now() - startTime, status: 'error' });\n                return { success: false, error: err.message || 'Failed to communicate with local AI engine' };\n            }\n        });\n        // ── GGUF Model Management ────────────────────────────────────────\n        electron__WEBPACK_IMPORTED_MODULE_0__.ipcMain.handle('gguf:select-file', async () => {\n            const result = await electron__WEBPACK_IMPORTED_MODULE_0__.dialog.showOpenDialog(this.mainWindow, {\n                title: 'اختر ملف النموذج (.gguf)',\n                properties: ['openFile'],\n                filters: [{ name: 'GGUF Models', extensions: ['gguf'] }]\n            });\n            if (result.canceled || result.filePaths.length === 0)\n                return { success: false, error: 'Cancelled' };\n            return this.modelManager.registerModel(result.filePaths[0]);\n        });\n        electron__WEBPACK_IMPORTED_MODULE_0__.ipcMain.handle('gguf:register-path', (_e, filePath) => this.modelManager.registerModel(filePath));\n        electron__WEBPACK_IMPORTED_MODULE_0__.ipcMain.handle('gguf:list', () => this.modelManager.listModels());\n        electron__WEBPACK_IMPORTED_MODULE_0__.ipcMain.handle('gguf:remove', (_e, id) => this.modelManager.removeModel(id));\n        electron__WEBPACK_IMPORTED_MODULE_0__.ipcMain.handle('gguf:start-server', async (_e, config) => await this.modelManager.startServer(config));\n        electron__WEBPACK_IMPORTED_MODULE_0__.ipcMain.handle('gguf:stop-server', () => this.modelManager.stopServer());\n        electron__WEBPACK_IMPORTED_MODULE_0__.ipcMain.handle('gguf:smart-suggest', async (_e, modelId) => await this.modelManager.getSmartSuggestions(modelId));\n        electron__WEBPACK_IMPORTED_MODULE_0__.ipcMain.handle('gguf:system-resources', async () => await this.modelManager.getSystemResources());\n        electron__WEBPACK_IMPORTED_MODULE_0__.ipcMain.handle('gguf:generate-api-key', () => ({ key: this.modelManager.generateApiKey() }));\n        electron__WEBPACK_IMPORTED_MODULE_0__.ipcMain.handle('gguf:load-mcp', () => {\n            try {\n                if (fs__WEBPACK_IMPORTED_MODULE_3___default().existsSync(this.mcpConfigPath)) {\n                    return { success: true, content: fs__WEBPACK_IMPORTED_MODULE_3___default().readFileSync(this.mcpConfigPath, 'utf8') };\n                }\n                return { success: true, content: JSON.stringify({ mcpServers: {} }, null, 2) };\n            }\n            catch (err) {\n                return { success: false, error: err.message };\n            }\n        });\n        electron__WEBPACK_IMPORTED_MODULE_0__.ipcMain.handle('gguf:save-mcp', (_e, content) => {\n            try {\n                const dir = path__WEBPACK_IMPORTED_MODULE_2___default().dirname(this.mcpConfigPath);\n                if (!fs__WEBPACK_IMPORTED_MODULE_3___default().existsSync(dir))\n                    fs__WEBPACK_IMPORTED_MODULE_3___default().mkdirSync(dir, { recursive: true });\n                fs__WEBPACK_IMPORTED_MODULE_3___default().writeFileSync(this.mcpConfigPath, content, 'utf8');\n                return { success: true };\n            }\n            catch (err) {\n                return { success: false, error: err.message };\n            }\n        });\n        // ── Export ───────────────────────────────────────────────────────\n        electron__WEBPACK_IMPORTED_MODULE_0__.ipcMain.handle('export:chat', async (_e, session, vaultPath) => {\n            const settings = (0,_settings_manager__WEBPACK_IMPORTED_MODULE_9__.loadSettings)();\n            const targetPath = vaultPath || settings?.obsidianVaultPath;\n            return this.exporter.exportChat(session, targetPath);\n        });\n        electron__WEBPACK_IMPORTED_MODULE_0__.ipcMain.handle('export:audit', async (_e, data, vaultPath) => {\n            const settings = (0,_settings_manager__WEBPACK_IMPORTED_MODULE_9__.loadSettings)();\n            const targetPath = vaultPath || settings?.obsidianVaultPath;\n            return this.exporter.exportAudit(data, targetPath);\n        });\n        // ── System ───────────────────────────────────────────────────────\n        electron__WEBPACK_IMPORTED_MODULE_0__.ipcMain.handle('open-external', async (_e, url) => {\n            try {\n                await electron__WEBPACK_IMPORTED_MODULE_0__.shell.openExternal(url);\n                return { success: true };\n            }\n            catch (err) {\n                return { success: false, error: err.message };\n            }\n        });\n        electron__WEBPACK_IMPORTED_MODULE_0__.ipcMain.handle('settings:save', (_e, settings) => {\n            try {\n                return (0,_settings_manager__WEBPACK_IMPORTED_MODULE_9__.saveSettings)(settings);\n            }\n            catch (err) {\n                return { success: false, error: err.message };\n            }\n        });\n        electron__WEBPACK_IMPORTED_MODULE_0__.ipcMain.handle('settings:load', () => {\n            try {\n                return (0,_settings_manager__WEBPACK_IMPORTED_MODULE_9__.loadSettings)();\n            }\n            catch (err) {\n                return null;\n            }\n        });\n        electron__WEBPACK_IMPORTED_MODULE_0__.ipcMain.handle('system:select-directory', async () => {\n            const result = await electron__WEBPACK_IMPORTED_MODULE_0__.dialog.showOpenDialog(this.mainWindow, {\n                properties: ['openDirectory', 'createDirectory']\n            });\n            if (!result.canceled && result.filePaths.length > 0) {\n                return { success: true, path: result.filePaths[0] };\n            }\n            return { success: false, error: 'Cancelled' };\n        });\n        electron__WEBPACK_IMPORTED_MODULE_0__.ipcMain.handle('metrics:add', (_e, entry) => this.logger.addLog(entry));\n        electron__WEBPACK_IMPORTED_MODULE_0__.ipcMain.handle('metrics:get-recent', (_e, limit) => this.logger.getRecentLogs(limit));\n        // ── RAG ─────────────────────────────────────────────────────────\n        electron__WEBPACK_IMPORTED_MODULE_0__.ipcMain.handle('rag:select-folder', async () => {\n            try {\n                const result = await electron__WEBPACK_IMPORTED_MODULE_0__.dialog.showOpenDialog(this.mainWindow, { properties: ['openDirectory'] });\n                if (!result.canceled && result.filePaths.length > 0) {\n                    const indexResult = await this.ragManager.indexFileOrFolder(result.filePaths[0]);\n                    return { ...indexResult, path: result.filePaths[0] };\n                }\n                return { success: false, error: 'Cancelled' };\n            }\n            catch (err) {\n                console.error('[RAG Select Folder Error]:', err);\n                return { success: false, error: err.message || 'Failed to index folder' };\n            }\n        });\n        electron__WEBPACK_IMPORTED_MODULE_0__.ipcMain.handle('rag:select-file', async () => {\n            try {\n                const result = await electron__WEBPACK_IMPORTED_MODULE_0__.dialog.showOpenDialog(this.mainWindow, {\n                    properties: ['openFile'],\n                    filters: [{ name: 'Documents', extensions: ['txt', 'md', 'pdf', 'js', 'ts', 'html', 'py'] }]\n                });\n                if (!result.canceled && result.filePaths.length > 0) {\n                    const indexResult = await this.ragManager.indexFileOrFolder(result.filePaths[0]);\n                    return { ...indexResult, path: result.filePaths[0] };\n                }\n                return { success: false, error: 'Cancelled' };\n            }\n            catch (err) {\n                console.error('[RAG Select File Error]:', err);\n                return { success: false, error: err.message || 'Failed to index file' };\n            }\n        });\n        electron__WEBPACK_IMPORTED_MODULE_0__.ipcMain.handle('rag:clear', () => { this.ragManager.clear(); return { success: true }; });\n        electron__WEBPACK_IMPORTED_MODULE_0__.ipcMain.handle('system:stats', async () => {\n            const getCPUUsage = () => {\n                const cpus = os__WEBPACK_IMPORTED_MODULE_4___default().cpus();\n                let idle = 0;\n                let total = 0;\n                cpus.forEach(cpu => {\n                    for (const type in cpu.times) {\n                        total += cpu.times[type];\n                    }\n                    idle += cpu.times.idle;\n                });\n                if (!this.lastCpuInfo) {\n                    this.lastCpuInfo = { idle, total };\n                    return 0;\n                }\n                const idleDiff = idle - this.lastCpuInfo.idle;\n                const totalDiff = total - this.lastCpuInfo.total;\n                this.lastCpuInfo = { idle, total };\n                if (totalDiff === 0)\n                    return 0;\n                return Math.max(0, Math.min(100, Math.round(100 * (1 - idleDiff / totalDiff))));\n            };\n            const getOSStats = () => {\n                const load = os__WEBPACK_IMPORTED_MODULE_4___default().loadavg();\n                const totalMem = os__WEBPACK_IMPORTED_MODULE_4___default().totalmem();\n                const freeMem = os__WEBPACK_IMPORTED_MODULE_4___default().freemem();\n                const ramPercent = Math.round(((totalMem - freeMem) / totalMem) * 100);\n                const cpuUsage = getCPUUsage();\n                return {\n                    cpuUsage,\n                    cpuStatus: cpuUsage > 90 ? 'error' : cpuUsage > 70 ? 'warning' : 'success',\n                    ramUsedGB: parseFloat(((totalMem - freeMem) / (1024 ** 3)).toFixed(2)),\n                    ramPercentage: ramPercent,\n                    ramStatus: ramPercent > 95 ? 'error' : ramPercent > 80 ? 'warning' : 'success',\n                    securityLevel: 100,\n                    reportsGenerated: 142,\n                    totalQueries: 150,\n                    avgResponseTime: 420,\n                    ragAccuracy: 98.2,\n                    cpuLoad: load[0],\n                    confidenceLevel: 96,\n                    systemUptime: `${Math.floor(os__WEBPACK_IMPORTED_MODULE_4___default().uptime() / 3600)}h+`,\n                    klDivergence: 0.12,\n                    privacyScanStatus: \"Verified\",\n                    systemHealth: (cpuUsage > 90 || ramPercent > 95) ? 'critical' : (cpuUsage > 70 || ramPercent > 80) ? 'warning' : 'healthy'\n                };\n            };\n            return new Promise((resolve) => {\n                const scriptPath = path__WEBPACK_IMPORTED_MODULE_2___default().join(__dirname, '../src/main/python_engine.py');\n                const tryPython = (cmd) => {\n                    const child = (0,child_process__WEBPACK_IMPORTED_MODULE_1__.spawn)(cmd, [scriptPath]);\n                    let dataString = '';\n                    let errorString = '';\n                    child.stdout.on('data', (data) => { dataString += data.toString(); });\n                    child.stderr.on('data', (data) => { errorString += data.toString(); });\n                    child.on('error', (err) => {\n                        if (err.code === 'ENOENT' && cmd === 'python') {\n                            tryPython('python3');\n                        }\n                        else {\n                            // Fallback to Node OS stats if Python is completely missing\n                            console.log('[Dashboard] Python missing, using Node OS fallback');\n                            resolve(getOSStats());\n                        }\n                    });\n                    child.on('close', (code) => {\n                        if (code === 0) {\n                            try {\n                                const parsed = JSON.parse(dataString);\n                                resolve({ ...parsed, error: null });\n                            }\n                            catch (e) {\n                                console.log('[Dashboard] Parse failed, using Node OS fallback');\n                                resolve({ ...getOSStats(), error: null });\n                            }\n                        }\n                        else {\n                            if (cmd === 'python') {\n                                tryPython('python3');\n                            }\n                            else {\n                                console.log('[Dashboard] Python failed (code ' + code + '), using Node OS fallback');\n                                resolve({ ...getOSStats(), error: null }); // Explicitly return error: null\n                            }\n                        }\n                    });\n                };\n                tryPython('python');\n            });\n        });\n    }\n}\nnew MainApp();\n\n\n//# sourceURL=webpack://local-ai-studio/./src/main/main.ts?\n}");

/***/ },

/***/ "./src/main/model_manager.ts"
/*!***********************************!*\
  !*** ./src/main/model_manager.ts ***!
  \***********************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ModelManager: () => (/* binding */ ModelManager)\n/* harmony export */ });\n/* harmony import */ var child_process__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! child_process */ \"child_process\");\n/* harmony import */ var child_process__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(child_process__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var os__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! os */ \"os\");\n/* harmony import */ var os__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(os__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_4__);\n\n\n\n\n\n// ------------------------------------------------------------------\n// Quantization extraction from filename\n// ------------------------------------------------------------------\nconst QUANT_KEYS = [\n    'Q2_K', 'Q3_K_S', 'Q3_K_M', 'Q3_K_L',\n    'Q4_K_S', 'Q4_0', 'Q4_K_M', 'Q5_K_S',\n    'Q5_0', 'Q5_K_M', 'Q6_K', 'Q8_0', 'F16', 'F32'\n];\nfunction detectQuantization(filename) {\n    const upper = filename.toUpperCase();\n    for (const q of QUANT_KEYS) {\n        if (upper.includes(q.replace('_', '-')) || upper.includes(q)) {\n            return q;\n        }\n    }\n    return 'Unknown';\n}\n// ------------------------------------------------------------------\n// Main ModelManager class\n// ------------------------------------------------------------------\nclass ModelManager {\n    models = new Map();\n    serverProcess = null;\n    activeServerId = null;\n    activePort = 8080;\n    maxModels = 5;\n    storageFile;\n    constructor() {\n        const dataDir = path__WEBPACK_IMPORTED_MODULE_3___default().join(os__WEBPACK_IMPORTED_MODULE_1___default().homedir(), '.localai-insight-studio');\n        if (!fs__WEBPACK_IMPORTED_MODULE_2___default().existsSync(dataDir))\n            fs__WEBPACK_IMPORTED_MODULE_2___default().mkdirSync(dataDir, { recursive: true });\n        this.storageFile = path__WEBPACK_IMPORTED_MODULE_3___default().join(dataDir, 'models.json');\n        this.loadFromDisk();\n    }\n    // ----------------------------------------------------------------\n    // Persistence\n    // ----------------------------------------------------------------\n    loadFromDisk() {\n        try {\n            if (fs__WEBPACK_IMPORTED_MODULE_2___default().existsSync(this.storageFile)) {\n                const data = JSON.parse(fs__WEBPACK_IMPORTED_MODULE_2___default().readFileSync(this.storageFile, 'utf8'));\n                data.forEach(m => {\n                    m.status = 'idle'; // reset on load\n                    this.models.set(m.id, m);\n                });\n            }\n        }\n        catch { /* ignore corrupt file */ }\n    }\n    saveToDisk() {\n        try {\n            const data = Array.from(this.models.values());\n            fs__WEBPACK_IMPORTED_MODULE_2___default().writeFileSync(this.storageFile, JSON.stringify(data, null, 2), 'utf8');\n        }\n        catch { /* ignore */ }\n    }\n    // ----------------------------------------------------------------\n    // Model CRUD\n    // ----------------------------------------------------------------\n    registerModel(filePath) {\n        try {\n            if (!filePath || typeof filePath !== 'string') {\n                return { success: false, error: 'مسار الملف غير صالح' };\n            }\n            if (!filePath.toLowerCase().endsWith('.gguf')) {\n                return { success: false, error: 'يُقبل فقط ملفات .gguf' };\n            }\n            if (!fs__WEBPACK_IMPORTED_MODULE_2___default().existsSync(filePath)) {\n                return { success: false, error: 'الملف غير موجود في المسار المحدد' };\n            }\n            if (this.models.size >= this.maxModels) {\n                return { success: false, error: `الحد الأقصى هو ${this.maxModels} نماذج` };\n            }\n            const stat = fs__WEBPACK_IMPORTED_MODULE_2___default().statSync(filePath);\n            const id = crypto__WEBPACK_IMPORTED_MODULE_4___default().randomUUID();\n            const filename = path__WEBPACK_IMPORTED_MODULE_3___default().basename(filePath);\n            const model = {\n                id,\n                name: filename.replace(/\\.gguf$/i, ''),\n                filePath,\n                fileSizeBytes: stat.size,\n                fileSizeMB: Math.round(stat.size / (1024 * 1024)),\n                quantization: detectQuantization(filename),\n                status: 'idle',\n                addedAt: new Date().toISOString()\n            };\n            this.models.set(id, model);\n            this.saveToDisk();\n            return { success: true, model };\n        }\n        catch (err) {\n            console.error('[Register Model Error]:', err);\n            return { success: false, error: err.message || 'فشل غير متوقع في إضافة النموذج' };\n        }\n    }\n    removeModel(id) {\n        if (id === this.activeServerId) {\n            this.stopServer();\n        }\n        this.models.delete(id);\n        this.saveToDisk();\n        return { success: true };\n    }\n    listModels() {\n        return Array.from(this.models.values());\n    }\n    getActiveServer() {\n        return { id: this.activeServerId, port: this.activePort };\n    }\n    // ----------------------------------------------------------------\n    // Server\n    // ----------------------------------------------------------------\n    async startServer(config) {\n        const model = this.models.get(config.modelId);\n        if (!model)\n            return { success: false, error: 'Model not found' };\n        // Stop any running server first\n        if (this.serverProcess)\n            this.stopServer();\n        // Mark as loading\n        model.status = 'loading';\n        this.activePort = config.port || 8080;\n        this.models.set(model.id, model);\n        return new Promise((resolve) => {\n            const args = [\n                '--model', model.filePath,\n                '--port', String(config.port || 8080),\n                '--ctx-size', String(config.contextLength || 4096),\n                '--n-gpu-layers', String(config.nGpuLayers || 0),\n                '--batch-size', String(config.evalBatch || 512),\n                '--rope-freq-base', String(config.ropeFreqBase || 10000),\n                '--rope-freq-scale', String(config.ropeFreqScale || 1.0),\n            ];\n            if (config.draftModel) {\n                const draft = this.models.get(config.draftModel);\n                if (draft) {\n                    args.push('--draft', draft.filePath);\n                }\n            }\n            if (config.keepInMemory)\n                args.push('--mlock');\n            if (config.useMmap)\n                args.push('--mmap');\n            if (config.serveOnLan)\n                args.push('--host', '0.0.0.0');\n            if (config.enableCors)\n                args.push('--cors');\n            try {\n                // Determine the correct path to llama-server\n                const isPackaged = __dirname.includes('app.asar');\n                const rootDir = isPackaged ? process.resourcesPath : path__WEBPACK_IMPORTED_MODULE_3___default().join(__dirname, '..');\n                const binFolder = path__WEBPACK_IMPORTED_MODULE_3___default().join(rootDir, 'bin');\n                const exePath = process.platform === 'win32' ? 'llama-server.exe' : 'llama-server';\n                const localServerPath = path__WEBPACK_IMPORTED_MODULE_3___default().join(binFolder, exePath);\n                const serverCmd = fs__WEBPACK_IMPORTED_MODULE_2___default().existsSync(localServerPath) ? localServerPath : exePath;\n                this.serverProcess = (0,child_process__WEBPACK_IMPORTED_MODULE_0__.spawn)(serverCmd, args, {\n                    stdio: ['ignore', 'pipe', 'pipe'],\n                    detached: false\n                });\n                let started = false;\n                const timeout = setTimeout(() => {\n                    if (!started) {\n                        model.status = 'error';\n                        model.errorMsg = 'Server startup timed out (30s)';\n                        this.models.set(model.id, model);\n                        resolve({ success: false, error: model.errorMsg });\n                    }\n                }, 30000);\n                this.serverProcess.stdout?.on('data', (data) => {\n                    const out = data.toString();\n                    if (!started && (out.includes('HTTP server listening') || out.includes('llama server listening'))) {\n                        started = true;\n                        clearTimeout(timeout);\n                        model.status = 'ready';\n                        model.errorMsg = undefined;\n                        this.activeServerId = model.id;\n                        this.models.set(model.id, model);\n                        resolve({ success: true });\n                    }\n                });\n                this.serverProcess.on('error', (err) => {\n                    if (!started) {\n                        clearTimeout(timeout);\n                        model.status = 'error';\n                        model.errorMsg = err.code === 'ENOENT'\n                            ? 'llama-server غير موجود في مجلد bin أو PATH — يرجى وضع llama-server.exe في مجلد bin داخل المشروع'\n                            : `فشل في تشغيل الخادم: ${err.message}`;\n                        this.models.set(model.id, model);\n                        resolve({ success: false, error: model.errorMsg });\n                    }\n                });\n                this.serverProcess.on('close', () => {\n                    if (this.activeServerId === model.id) {\n                        model.status = 'idle';\n                        this.activeServerId = null;\n                        this.models.set(model.id, model);\n                    }\n                });\n            }\n            catch (err) {\n                model.status = 'error';\n                model.errorMsg = err.message;\n                this.models.set(model.id, model);\n                resolve({ success: false, error: err.message });\n            }\n        });\n    }\n    stopServer() {\n        if (this.serverProcess) {\n            this.serverProcess.kill('SIGTERM');\n            this.serverProcess = null;\n        }\n        if (this.activeServerId) {\n            const model = this.models.get(this.activeServerId);\n            if (model) {\n                model.status = 'idle';\n                this.models.set(this.activeServerId, model);\n            }\n            this.activeServerId = null;\n        }\n        return { success: true };\n    }\n    // ----------------------------------------------------------------\n    // Legacy Ollama (kept for backward compatibility)\n    // ----------------------------------------------------------------\n    async getStatus() {\n        return new Promise((resolve) => {\n            (0,child_process__WEBPACK_IMPORTED_MODULE_0__.exec)('ollama --version', (error) => {\n                if (error) {\n                    resolve({ active: false, message: 'Ollama is not installed or not running' });\n                }\n                else {\n                    resolve({ active: true, message: 'Ollama engine is ready' });\n                }\n            });\n        });\n    }\n    async chat(message, model = 'llama3') {\n        // If GGUF server is running, use it via API\n        if (this.activeServerId) {\n            return this.chatGguf(message);\n        }\n        // Fallback to Ollama\n        return new Promise((resolve, reject) => {\n            (0,child_process__WEBPACK_IMPORTED_MODULE_0__.exec)(`ollama run ${model} \"${message.replace(/\"/g, '\\\\\"')}\"`, { encoding: 'utf8' }, (error, stdout, stderr) => {\n                if (error) {\n                    console.error('Ollama Error:', stderr);\n                    reject(error);\n                }\n                else {\n                    resolve(stdout.trim());\n                }\n            });\n        });\n    }\n    async chatGguf(message) {\n        return new Promise(async (resolve, reject) => {\n            try {\n                const response = await fetch(`http://127.0.0.1:${this.activePort}/v1/chat/completions`, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                        messages: [{ role: 'user', content: message }],\n                        stream: false\n                    })\n                });\n                if (!response.ok)\n                    throw new Error(`HTTP error! status: ${response.status}`);\n                const data = await response.json();\n                resolve(data.choices[0].message.content);\n            }\n            catch (error) {\n                console.error('GGUF Chat Error:', error);\n                reject(error);\n            }\n        });\n    }\n    async loadModel(modelName) {\n        return new Promise((resolve) => {\n            (0,child_process__WEBPACK_IMPORTED_MODULE_0__.exec)(`ollama pull ${modelName}`, (error) => {\n                resolve({ success: !error });\n            });\n        });\n    }\n    // ----------------------------------------------------------------\n    // System Resources\n    // ----------------------------------------------------------------\n    async getSystemResources() {\n        const totalRamGb = Math.round(os__WEBPACK_IMPORTED_MODULE_1___default().totalmem() / (1024 ** 3));\n        const availableRamGb = Math.round(os__WEBPACK_IMPORTED_MODULE_1___default().freemem() / (1024 ** 3));\n        const cpuCores = os__WEBPACK_IMPORTED_MODULE_1___default().cpus().length;\n        const cpuModel = os__WEBPACK_IMPORTED_MODULE_1___default().cpus()[0]?.model || 'Unknown CPU';\n        const gpus = await new Promise((resolve) => {\n            // Use PowerShell for reliability on Windows 10/11 (wmic is deprecated)\n            const cmd = 'powershell -NoProfile -Command \"Get-WmiObject Win32_VideoController | Select-Object Name, AdapterRAM | ConvertTo-Json -Compress\"';\n            (0,child_process__WEBPACK_IMPORTED_MODULE_0__.exec)(cmd, (error, stdout) => {\n                if (error || !stdout.trim()) {\n                    resolve([{ name: 'GPU (لم يُكتشف)', vramMb: 0 }]);\n                    return;\n                }\n                try {\n                    const raw = JSON.parse(stdout.trim());\n                    const list = Array.isArray(raw) ? raw : [raw];\n                    const result = list\n                        .map(g => ({\n                        name: (g.Name || g.name || '').trim() || 'Unknown GPU',\n                        vramMb: Math.round(((g.AdapterRAM || g.adapterRAM || 0)) / (1024 * 1024))\n                    }))\n                        .filter(g => g.name);\n                    resolve(result.length > 0 ? result : [{ name: 'GPU (لم يُكتشف)', vramMb: 0 }]);\n                }\n                catch {\n                    resolve([{ name: 'GPU (خطأ في الاكتشاف)', vramMb: 0 }]);\n                }\n            });\n        });\n        return { totalRamGb, availableRamGb, cpuCores, cpuModel, gpus };\n    }\n    // ----------------------------------------------------------------\n    // Smart Suggestions\n    // ----------------------------------------------------------------\n    async getSmartSuggestions(modelId) {\n        const model = this.models.get(modelId);\n        if (!model)\n            return null;\n        const resources = await this.getSystemResources();\n        const modelSizeMB = model.fileSizeMB;\n        const ramGb = resources.totalRamGb;\n        const hasGpu = resources.gpus.some(g => g.vramMb > 1000);\n        const maxVramGb = Math.max(...resources.gpus.map(g => g.vramMb / 1024), 0);\n        // Heuristics based on model size and RAM\n        let contextLength = 4096;\n        let nGpuLayers = 0;\n        let suggestedRamGb = Math.min(Math.ceil(modelSizeMB / 1024) + 2, ramGb - 2);\n        let suggestedVramGb = 0;\n        let evalBatch = 512;\n        let temperature = 0.7;\n        let topK = 40;\n        let topP = 0.9;\n        let repeatPenalty = 1.1;\n        let cpuThreads = Math.max(Math.floor(resources.cpuCores * 0.75), 1);\n        if (modelSizeMB < 4000) { // ~3B models\n            contextLength = 8192;\n        }\n        else if (modelSizeMB < 8000) { // ~7B models\n            contextLength = 4096;\n        }\n        else if (modelSizeMB < 20000) { // ~13B models\n            contextLength = 2048;\n            evalBatch = 256;\n        }\n        else { // 30B+\n            contextLength = 1024;\n            evalBatch = 128;\n        }\n        if (hasGpu) {\n            nGpuLayers = maxVramGb >= 12 ? 35 : maxVramGb >= 8 ? 20 : 10;\n            suggestedVramGb = Math.min(Math.floor(maxVramGb * 0.8), 16);\n        }\n        const quant = model.quantization;\n        if (quant.includes('Q8') || quant.includes('F16') || quant.includes('F32')) {\n            temperature = 0.5;\n        }\n        const reasoning = `النموذج حجمه ${Math.round(modelSizeMB / 1024)} GB، النظام يملك ${ramGb} GB RAM ${hasGpu ? `و GPU بـ ${Math.round(maxVramGb)} GB VRAM` : 'بدون GPU مخصص'}. الإعدادات مُحسَّنة للأداء الأمثل.`;\n        return {\n            contextLength, nGpuLayers,\n            ramGb: suggestedRamGb,\n            vramGb: suggestedVramGb,\n            evalBatch, temperature, topK, topP,\n            repeatPenalty, cpuThreads, reasoning\n        };\n    }\n    // ----------------------------------------------------------------\n    // API Key Generation\n    // ----------------------------------------------------------------\n    generateApiKey() {\n        return `lk-${crypto__WEBPACK_IMPORTED_MODULE_4___default().randomBytes(20).toString('hex')}`;\n    }\n}\n\n\n//# sourceURL=webpack://local-ai-studio/./src/main/model_manager.ts?\n}");

/***/ },

/***/ "./src/main/obsidian_exporter.ts"
/*!***************************************!*\
  !*** ./src/main/obsidian_exporter.ts ***!
  \***************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ObsidianExporter: () => (/* binding */ ObsidianExporter)\n/* harmony export */ });\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var electron__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! electron */ \"electron\");\n/* harmony import */ var electron__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(electron__WEBPACK_IMPORTED_MODULE_2__);\n\n\n\nclass ObsidianExporter {\n    async exportChat(session, vaultPath) {\n        try {\n            const fileName = `${session.title.replace(/[^a-z0-9]/gi, '_').toLowerCase()}-${Date.now()}.md`;\n            const targetDir = vaultPath && fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(vaultPath)\n                ? vaultPath\n                : path__WEBPACK_IMPORTED_MODULE_1___default().join(electron__WEBPACK_IMPORTED_MODULE_2__.app.getPath('userData'), 'obsidian_vault');\n            if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(targetDir)) {\n                fs__WEBPACK_IMPORTED_MODULE_0___default().mkdirSync(targetDir, { recursive: true });\n            }\n            const filePath = path__WEBPACK_IMPORTED_MODULE_1___default().join(targetDir, fileName);\n            const content = `---\r\ntype: ai-chat\r\nsession: ${session.title}\r\ndate: ${new Date().toISOString()}\r\ntags: [localai, insight-studio, documentation]\r\n---\r\n# ${session.title}\r\n\r\n${session.messages.map((m) => `### [${m.sender === 'user' ? '👤 المستخدم' : '🤖 الذكاء الاصطناعي'}] - ${new Date(m.timestamp).toLocaleTimeString()}\r\n${m.text}\r\n`).join('\\n---\\n')}\r\n\r\n---\r\n*تولدت هذه الجلسة آلياً عبر LocalAI Insight Studio بصيغة Markdown متوافقة مع Obsidian.*`;\n            fs__WEBPACK_IMPORTED_MODULE_0___default().writeFileSync(filePath, content, 'utf8');\n            return { success: true, filePath };\n        }\n        catch (error) {\n            console.error('Failed to export to Obsidian:', error);\n            return { success: false, error };\n        }\n    }\n    async exportAudit(data, vaultPath) {\n        const fileName = `AI-Audit-${Date.now()}.md`;\n        const targetDir = vaultPath && fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(vaultPath)\n            ? vaultPath\n            : path__WEBPACK_IMPORTED_MODULE_1___default().join(electron__WEBPACK_IMPORTED_MODULE_2__.app.getPath('userData'), 'obsidian_vault');\n        if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(targetDir)) {\n            fs__WEBPACK_IMPORTED_MODULE_0___default().mkdirSync(targetDir, { recursive: true });\n        }\n        const filePath = path__WEBPACK_IMPORTED_MODULE_1___default().join(targetDir, fileName);\n        const content = `---\r\ntype: audit\r\ndate: ${new Date().toISOString()}\r\n---\r\n# تقرير أداء النظام\r\n\r\n- **استهلاك المعالج:** ${data.cpuUsage}%\r\n- **استهلاك الرام:** ${data.ramPercentage}%\r\n- **حالة الأمان:** آمن (محلي بالكامل)\r\n\r\nGenerated by LocalAI Studio.`;\n        fs__WEBPACK_IMPORTED_MODULE_0___default().writeFileSync(filePath, content, 'utf8');\n        return filePath;\n    }\n}\n\n\n//# sourceURL=webpack://local-ai-studio/./src/main/obsidian_exporter.ts?\n}");

/***/ },

/***/ "./src/main/rag_manager.ts"
/*!*********************************!*\
  !*** ./src/main/rag_manager.ts ***!
  \*********************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   RagManager: () => (/* binding */ RagManager)\n/* harmony export */ });\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var pdf_parse__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! pdf-parse */ \"pdf-parse\");\n/* harmony import */ var pdf_parse__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(pdf_parse__WEBPACK_IMPORTED_MODULE_2__);\n\n\n// @ts-ignore\n\nclass RagManager {\n    context = [];\n    maxFiles = 50;\n    async indexFileOrFolder(targetPath) {\n        this.context = []; // Clear previous context\n        if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(targetPath))\n            return { success: false, error: 'Path does not exist' };\n        const stats = fs__WEBPACK_IMPORTED_MODULE_0___default().statSync(targetPath);\n        if (stats.isDirectory()) {\n            await this.indexDirectory(targetPath);\n        }\n        else {\n            await this.indexSingleFile(targetPath);\n        }\n        return { success: true, fileCount: this.context.length };\n    }\n    async indexDirectory(dirPath) {\n        const files = fs__WEBPACK_IMPORTED_MODULE_0___default().readdirSync(dirPath);\n        for (const file of files) {\n            const fullPath = path__WEBPACK_IMPORTED_MODULE_1___default().join(dirPath, file);\n            const stats = fs__WEBPACK_IMPORTED_MODULE_0___default().statSync(fullPath);\n            if (stats.isDirectory()) {\n                // Skip node_modules and hidden folders for performance\n                if (file !== 'node_modules' && !file.startsWith('.')) {\n                    await this.indexDirectory(fullPath);\n                }\n            }\n            else {\n                if (this.context.length >= this.maxFiles)\n                    break;\n                await this.indexSingleFile(fullPath);\n            }\n        }\n    }\n    async indexSingleFile(filePath) {\n        const ext = path__WEBPACK_IMPORTED_MODULE_1___default().extname(filePath).toLowerCase();\n        const fileName = path__WEBPACK_IMPORTED_MODULE_1___default().basename(filePath);\n        try {\n            if (['.txt', '.md', '.js', '.ts', '.tsx', '.jsx', '.html', '.css', '.json', '.py'].includes(ext)) {\n                const content = fs__WEBPACK_IMPORTED_MODULE_0___default().readFileSync(filePath, 'utf-8');\n                this.context.push({ fileName, content });\n            }\n            else if (ext === '.pdf') {\n                const dataBuffer = fs__WEBPACK_IMPORTED_MODULE_0___default().readFileSync(filePath);\n                const data = await pdf_parse__WEBPACK_IMPORTED_MODULE_2___default()(dataBuffer);\n                this.context.push({ fileName, content: data.text });\n            }\n        }\n        catch (error) {\n            console.error(`Failed to index file ${filePath}:`, error);\n        }\n    }\n    getContextString() {\n        if (this.context.length === 0)\n            return '';\n        let contextStr = '\\n--- السير المحلي المرفق (Context) ---\\n';\n        this.context.forEach(ctx => {\n            contextStr += `\\n[File: ${ctx.fileName}]\\n${ctx.content}\\n`;\n        });\n        contextStr += '\\n--- نهاية السياق ---\\n';\n        // Limit context length slightly to avoid blowing up LLM limit (can be improved with real RAG later)\n        return contextStr.substring(0, 10000);\n    }\n    clear() {\n        this.context = [];\n    }\n}\n\n\n//# sourceURL=webpack://local-ai-studio/./src/main/rag_manager.ts?\n}");

/***/ },

/***/ "./src/main/session_manager.ts"
/*!*************************************!*\
  !*** ./src/main/session_manager.ts ***!
  \*************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SessionManager: () => (/* binding */ SessionManager)\n/* harmony export */ });\nclass SessionManager {\n    currentSessionId = null;\n    startSession() {\n        this.currentSessionId = `session_${Date.now()}`;\n        console.log(\"New Private Session Started\");\n    }\n    clearSessionData() {\n        // مسح الذاكرة المؤقتة لضمان الخصوصية\n        this.currentSessionId = null;\n    }\n}\n\n\n//# sourceURL=webpack://local-ai-studio/./src/main/session_manager.ts?\n}");

/***/ },

/***/ "./src/main/settings_manager.ts"
/*!**************************************!*\
  !*** ./src/main/settings_manager.ts ***!
  \**************************************/
(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   loadSettings: () => (/* binding */ loadSettings),\n/* harmony export */   saveSettings: () => (/* binding */ saveSettings)\n/* harmony export */ });\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var electron__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! electron */ \"electron\");\n/* harmony import */ var electron__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(electron__WEBPACK_IMPORTED_MODULE_2__);\n\n\n\nconst SETTINGS_PATH = path__WEBPACK_IMPORTED_MODULE_1___default().join(electron__WEBPACK_IMPORTED_MODULE_2__.app.getPath('userData'), 'settings.json');\nconst saveSettings = (settings) => {\n    try {\n        fs__WEBPACK_IMPORTED_MODULE_0___default().writeFileSync(SETTINGS_PATH, JSON.stringify(settings, null, 2), 'utf-8');\n        return { success: true };\n    }\n    catch (error) {\n        console.error('Failed to save settings:', error);\n        return { success: false, error };\n    }\n};\nconst loadSettings = () => {\n    try {\n        if (!fs__WEBPACK_IMPORTED_MODULE_0___default().existsSync(SETTINGS_PATH)) {\n            const defaultSettings = {\n                theme: 'dark',\n                aiModel: 'gguf-v1',\n                contextLimit: 4096,\n                obsidianVaultPath: ''\n            };\n            saveSettings(defaultSettings);\n            return defaultSettings;\n        }\n        const data = fs__WEBPACK_IMPORTED_MODULE_0___default().readFileSync(SETTINGS_PATH, 'utf-8');\n        return JSON.parse(data);\n    }\n    catch (error) {\n        console.error('Failed to load settings:', error);\n        return null;\n    }\n};\n\n\n//# sourceURL=webpack://local-ai-studio/./src/main/settings_manager.ts?\n}");

/***/ },

/***/ "dotenv"
/*!*************************!*\
  !*** external "dotenv" ***!
  \*************************/
(module) {

module.exports = require("dotenv");

/***/ },

/***/ "electron"
/*!***************************!*\
  !*** external "electron" ***!
  \***************************/
(module) {

module.exports = require("electron");

/***/ },

/***/ "pdf-parse"
/*!****************************!*\
  !*** external "pdf-parse" ***!
  \****************************/
(module) {

module.exports = require("pdf-parse");

/***/ },

/***/ "child_process"
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
(module) {

module.exports = require("child_process");

/***/ },

/***/ "crypto"
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
(module) {

module.exports = require("crypto");

/***/ },

/***/ "fs"
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
(module) {

module.exports = require("fs");

/***/ },

/***/ "os"
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
(module) {

module.exports = require("os");

/***/ },

/***/ "path"
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
(module) {

module.exports = require("path");

/***/ }

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Check if module exists (development only)
/******/ 		if (__webpack_modules__[moduleId] === undefined) {
/******/ 			var e = new Error("Cannot find module '" + moduleId + "'");
/******/ 			e.code = 'MODULE_NOT_FOUND';
/******/ 			throw e;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	(() => {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = (module) => {
/******/ 			var getter = module && module.__esModule ?
/******/ 				() => (module['default']) :
/******/ 				() => (module);
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./src/main/main.ts");
/******/ 	
/******/ })()
;